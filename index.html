<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>SISTEMA DE CONSULTA BAREMOS</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f9; margin: 20px; text-transform: uppercase; }
    .container { max-width: 800px; margin: auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    h2 { text-align: center; margin-bottom: 20px; }
    .linha { display: flex; align-items: center; margin-bottom: 15px; }
    .linha label { width: 150px; font-weight: bold; }
    .linha input, .linha select { flex: 1; padding: 8px; font-size: 14px; border: 1px solid #ccc; border-radius: 6px; }
    .linha button { margin-left: 10px; padding: 8px 12px; cursor: pointer; border: none; border-radius: 6px; background: #0077cc; color: #fff; font-weight: bold; }
    .linha button:hover { background: #005fa3; }
    .btn-grupo { display: flex; gap: 10px; justify-content: center; margin: 20px 0; }
    .btn-grupo button { background: #444; }
    .btn-grupo button:hover { background: #222; }
    .resultado { background: #eef; border: 1px solid #99c; border-radius: 6px; padding: 15px; min-height: 80px; margin-top: 20px; white-space: pre-line; }
    
   body { 
      font-family: "Segoe UI", Arial, sans-serif; 
      background: #f0f2f5; 
      margin: 0; 
      padding: 0; 
      display: flex; 
      justify-content: center; 
      align-items: center; 
      min-height: 97vh; 
    }

    .container { 
      width: 100%; 
      height: 84vh; 
      max-width: 750px;   /* limite no desktop */
      background: #fff; 
      padding: 55px; 
      border-radius: 0; 
      box-shadow: 0 0 0 rgba(0,0,0,0); 
      display: flex; 
      flex-direction: column; 
    }

    h2 { 
      text-align: center; 
      margin-bottom: 25px; 
      font-size: 24px; 
      font-weight: bold; 
      color: #222; 
      letter-spacing: 1px;
    }

    /* Linhas de inputs */
    .linha { 
      display: flex; 
      align-items: center; 
      margin-bottom: 18px; 
      gap: 10px;
      flex-wrap: wrap;
    }

    .linha label { 
      font-weight: bold; 
      font-size: 16px; 
      color: #333; 
      min-width: 140px;
    }

    .linha input, 
    .linha select { 
      flex: 1; 
      padding: 12px; 
      font-size: 16px; 
      border: 1px solid #ccc; 
      border-radius: 12px; 
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.05); 
      max-width: 100%; 
    }

    /* Bot√£o lupa */
    .linha button { 
      padding: 10px 14px; 
      cursor: pointer; 
      border: none; 
      border-radius: 12px; 
      background: #0077cc; 
      color: #fff; 
      font-weight: bold; 
      font-size: 16px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.2);
      transition: 0.2s;
    }

    .linha button:hover { 
      background: #005fa3; 
    }

    /* Grupo de bot√µes */
    .btn-grupo { 
      display: flex; 
      gap: 14px; 
      justify-content: center; 
      margin: 25px 0; 
    }

    .btn-grupo button { 
      flex: 1;
      background: #fff; 
      color: #000; 
      border: 2px solid #000; 
      padding: 14px; 
      border-radius: 14px; 
      font-weight: bold; 
      font-size: 18px;
      cursor: pointer; 
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
      transition: all 0.25s ease;
    }

    .btn-grupo button:hover { 
      background: #f5f5f5; 
    }

    .btn-grupo button.ativo { 
      background: #000; 
      color: #fff; 
    }

    .btn-limpar { 
      background: #c00 !important; 
      color: #fff !important; 
      border: 2px solid #900 !important; 
    }

    .btn-limpar:hover { 
      background: #900 !important; 
    }

    /* Resultado */
    .resultado { 
      background: #f9fbff; 
      border: 1px solid #ccd; 
      border-radius: 16px; 
      padding: 20px; 
      flex: 1; 
      margin-top: 20px; 
      box-shadow: 0 3px 8px rgba(0,0,0,0.15);
      white-space: pre-line; 
      font-size: 16px; 
      font-weight: 500;
      color: #333;
      overflow-y: auto;
    }

    /* Responsivo */
    @media (max-width: 600px) {
      .linha { 
        flex-direction: column; 
        align-items: stretch; 
      }

      .linha label { 
        min-width: unset; 
        margin-bottom: 6px; 
        font-size: 18px;
      }

      .linha input, 
      .linha select { 
        width: 100%; 
        font-size: 18px; 
      }

      .linha button { 
        align-self: flex-end; 
        margin-top: 6px;
      }
    }
        .assinatura {
      position: fixed;
      bottom: 10px;
      left: 0;
      right: 0;
      text-align: center;
      font-style: italic;
      font-family: 'Courier New', Courier, monospace;
      font-size: 14px;
      color: #555;
    }
   /* Caixa da lista suspensa */
    .popup-lista {
      display: none; /* come√ßa oculta */
      position: absolute;
      top: 100%; 
      left: 0;
      right: 0;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 10px;
      max-height: 250px;
      overflow-y: auto;
      margin-top: 4px;
      z-index: 2000;
      box-shadow: 0 4px 12px rgba(0,0,0,0.25);
      font-size: 16px;
    }

    /* Itens da lista */
    .popup-lista div {
      padding: 12px;
      cursor: pointer;
      border-bottom: 1px solid #eee;
      transition: background 0.2s;
    }
    .popup-lista div:hover {
      background: #0077cc;
      color: #fff;
    }

    /* Responsividade para celular */
    @media (max-width: 600px) {
      #filtroB {
        font-size: 18px;
        padding: 14px;
      }
      .popup-lista {
        font-size: 18px;
        max-height: 50vh; /* ocupa metade da tela */
      }
    }


  </style>
</head>
<body>
  
  <div class="container">
    <h2>SISTEMA DE CONSULTA BAREMOS</h2>
    <p class="assinatura">¬© 2025 Emanuel Aguiar</p>
    <!-- Pesquisa Coluna A -->
    <div class="linha">
      <label>C√≥digo Baremo:</label>
      <input type="text" id="pesqA" maxlength="10" oninput="this.value=this.value.replace(/[^0-9]/g,'')">
      <button onclick="pesquisar('A')">üîç</button>
    </div>

    <!-- Pesquisa Coluna C -->
    <div class="linha">
      <label>CODIGO DE VOZ:</label>
      <input type="text" id="pesqC" maxlength="6" 
  oninput="this.value=this.value.replace(/[^a-zA-Z0-9]/g,'').toUpperCase()">
      <button onclick="pesquisar('C')">üîç</button>
    </div>

    <!-- Pesquisa Coluna G -->
    <div class="linha">
      <label>CODIGO PRESTA√á√ÉO:</label>
      <input type="text" id="pesqG" maxlength="6" 
  oninput="this.value=this.value.replace(/[^a-zA-Z0-9]/g,'').toUpperCase()">
      <button onclick="pesquisar('G')">üîç</button>
    </div>

    <!-- Bot√µes BT / MT -->
    <div class="btn-grupo">
  <button id="btnBT" onclick="filtrarTipo('BT', this)">BT</button>
  <button id="btnMT" onclick="filtrarTipo('MT', this)">MT</button>
  <button class="btn-limpar" onclick="limparFiltros()">LIMPAR</button>
    </div>

   <!-- Resultado / Descri√ß√£o -->
    <div class="resultado" id="resultado">descri√ß√£o da atividade selecionada...</div><BR>

    <!-- Lista suspensa Coluna B -->
    <div class="linha" style="position: relative; flex-direction: column; align-items: stretch;">
      <label>LISTA DE BAREMOS:</label>
      <input type="text" id="filtroB" placeholder="Digite para filtrar...">
      <div id="popupListaB" class="popup-lista"></div>
    </div>
    
  </div>
  
<script>
let cabecalho = [];
let dados = [];
let filtroAtivo = null; // guarda qual filtro est√° ativo (BT ou MT)

// Carregar CSV
async function carregarCSV() {
  try {
    const resposta = await fetch("dados.csv");
    const texto = await resposta.text();

    const linhas = texto.trim().split("\n").map(l => l.split(";"));
    cabecalho = linhas[0];
    dados = linhas.slice(1);

    atualizarLista(true); // preenche lista completa sem filtro
  } catch (erro) {
    console.error("Erro ao carregar CSV:", erro);
    document.getElementById("resultado").innerText = "ERRO AO CARREGAR DADOS!";
  }
}

// Atualiza lista suspensa considerando o filtro ativo
function atualizarLista(incluirDuplicados = false) {
  let filtrados = filtroAtivo ? dados.filter(l => l[3] === filtroAtivo) : dados;

  let valoresB = incluirDuplicados ? filtrados.map(l => l[1]) : [...new Set(filtrados.map(l => l[1]))];

  const lista = document.getElementById("listaB");
  lista.innerHTML = `<option value="">--SELECIONE--</option>` + valoresB.map(v => `<option>${v}</option>`).join("");
}

// Pesquisa nas colunas
function pesquisar(coluna) {
  let idxMap = { "A": 0, "C": 2, "G": 6 };
  let idx = idxMap[coluna];
  let inputId = { "A": "pesqA", "C": "pesqC", "G": "pesqG" }[coluna];

  let valor = document.getElementById(inputId).value.trim().toUpperCase();
  if (!valor) return alert("DIGITE UM VALOR!");

  let registro = dados.find(l => l[idx].toUpperCase() === valor);
  if (registro) {
    mostrarResultado(registro);
  } else {
    document.getElementById("resultado").innerText = "NENHUM REGISTRO ENCONTRADO!";
  }
}

// Ativa filtro BT/MT
function filtrarTipo(tipo, botao) {
  document.querySelectorAll(".btn-grupo button").forEach(b => b.classList.remove("ativo"));
  filtroAtivo = tipo;
  botao.classList.add("ativo");
  atualizarLista();
  document.getElementById("resultado").innerText = `LISTA FILTRADA PELO TIPO ${tipo}`;
}

// Selecionar pela lista suspensa (coluna B)
function selecionarB() {
  let valor = document.getElementById("listaB").value;
  if (!valor) return;
  let registro = dados.find(l => l[1] === valor && (!filtroAtivo || l[3] === filtroAtivo));
  if (registro) {
    mostrarResultado(registro);
  }
}

// Limpa todos os filtros, pesquisas e resultados
function limparFiltros() {
  // Desativa filtros BT/MT
  filtroAtivo = null;
  document.querySelectorAll(".btn-grupo button").forEach(b => b.classList.remove("ativo"));

  // Limpa todos os inputs
  document.getElementById("pesqA").value = "";
  document.getElementById("pesqC").value = "";
  document.getElementById("pesqG").value = "";

  // Limpa sele√ß√£o da lista de Baremos
  document.getElementById("listaB").value = "";

  // Limpa resultado/descri√ß√£o
  document.getElementById("resultado").innerText = "RESULTADO SER√Å EXIBIDO AQUI...";

  // Atualiza lista para mostrar todos os Baremos (incluindo repetidos)
  atualizarLista(true);
}

// Exibe o resultado em formato de card
function mostrarResultado(registro) {
  let descricao = registro[9]; // Coluna J (descri√ß√£o)
  let camposHTML = `
    <div><strong>${cabecalho[0]}:</strong> ${registro[0]}</div>
    <div><strong>${cabecalho[1]}:</strong> ${registro[1]}</div>
    <div><strong>${cabecalho[2]}:</strong> ${registro[2]}</div>
    <div><strong>${cabecalho[3]}:</strong> ${registro[3]}</div>
    <div><strong>${cabecalho[6]}:</strong> ${registro[6]}</div>
  `;
  document.getElementById("resultado").innerHTML = `
    <div style="padding:10px;">
      ${camposHTML}
      <div style="margin-top:15px;">
        <strong>${cabecalho[9]}:</strong>
        <div style="
          background:#ffffff;
          border:1px solid #ddd;
          border-radius:12px;
          padding:15px;
          margin-top:8px;
          box-shadow:0 2px 6px rgba(0,0,0,0.1);
          font-size:14px;
          line-height:1.4;
        ">
          ${descricao}
        </div>
      </div>
    </div>
  `;
}
 // Renderiza lista suspensa (todos ou filtrados)
  function renderizarLista(filtro = "") {
    filtro = filtro.toUpperCase();
    let filtrados = dados.filter(l => l[1].toUpperCase().includes(filtro) && (!filtroAtivo || l[3] === filtroAtivo));

    let popup = document.getElementById("popupListaB");
    popup.innerHTML = "";

    if (filtrados.length > 0) {
      filtrados.forEach(r => {
        let item = document.createElement("div");
        item.textContent = r[1];
        item.onclick = () => {
          document.getElementById("filtroB").value = r[1];
          popup.style.display = "none"; // fecha ao selecionar
          mostrarResultado(r);
        };
        popup.appendChild(item);
      });
    } else {
      popup.innerHTML = "<div style='padding:10px;color:#999;'>Nenhum resultado</div>";
    }
  }

  // Mostra todos ao focar no campo
  document.getElementById("filtroB").addEventListener("focus", function () {
    renderizarLista("");
    document.getElementById("popupListaB").style.display = "block";
  });

  // Filtra enquanto digita
  document.getElementById("filtroB").addEventListener("input", function () {
    renderizarLista(this.value);
    document.getElementById("popupListaB").style.display = "block";
  });

  // Fecha lista ao clicar fora
  document.addEventListener("click", function (e) {
    let campo = document.getElementById("filtroB");
    let lista = document.getElementById("popupListaB");
    if (!campo.contains(e.target) && !lista.contains(e.target)) {
      lista.style.display = "none";
    }
  });

// Inicializa carregamento do CSV
carregarCSV();
</script>
</body>
</html>
