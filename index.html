<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SISTEMA DE CONSULTA BAREMOS</title>
  <style>
    /* --- seu CSS (resumido/ajustado) --- */
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background: #f0f2f5;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 97vh;
      text-transform: uppercase;
      font-size: 16px; /* base confort√°vel para celular */
    }
    .container {
      width: 100%;
      height: 84vh;
      max-width: 750px;
      background: #fff;
      padding: 28px;
      display: flex;
      flex-direction: column;
      box-sizing: border-box;
    }
    h2 { text-align:center; margin-bottom:14px; color:#222; font-size:22px; }
    .linha {
      display:flex; align-items:center; gap:10px; margin-bottom:14px; flex-wrap:wrap;
    }
    .linha label { min-width:140px; font-weight:700; color:#333; }
    .linha input, .linha select {
      flex:1; padding:12px; font-size:16px; border-radius:12px; border:1px solid #ccc;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.03);
      text-transform: uppercase;
    }
    .linha button {
      padding:10px 14px; border-radius:12px; border:none; background:#0077cc; color:#fff;
      cursor:pointer; font-weight:700;
    }
    .btn-grupo {
      display: flex;
      justify-content: center;   /* centraliza no container */
      gap: 20px;                 /* espa√ßo entre bot√µes */
      flex-wrap: wrap;           /* quebra linha se n√£o couber */
      margin: 25px 0;
    }

    .btn-grupo button { 
      min-width: 120px;          /* largura m√≠nima confort√°vel */
      flex: 0 0 auto;            /* n√£o estica mais que o necess√°rio */
      background: #fff; 
      color: #000; 
      border: 2px solid #000; 
      padding: 14px 22px;        /* mais espa√ßo lateral */
      border-radius: 14px; 
      font-weight: bold; 
      font-size: 18px;
      cursor: pointer; 
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
      transition: all 0.25s ease;
    }

    .btn-grupo button:hover { 
      background: #f5f5f5; 
    }

    .btn-grupo button.ativo { 
      background: #000; 
      color: #fff; 
    }

    .btn-limpar { 
      background: #c00 !important; 
      color: #fff !important; 
      border: 2px solid #900 !important; 
    }

    .btn-limpar:hover { 
      background: #900 !important; 
    }


    .resultado {
      background:#f9fbff; border:1px solid #ccd; border-radius:16px; padding:18px;
      flex:1; margin-top:12px; overflow-y:auto; font-size:15px; color:#222;
    }

    .assinatura { position:fixed; bottom:10px; left:0; right:0; text-align:center; font-style:italic; font-family:'Courier New',monospace; font-size:13px; color:#555; }

    /* -------- POPUP (estilo que voc√™ enviou) -------- */
    .popup {
      display: none; /* IMPORTANT: mantido como NONE por padr√£o */
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      width: 92%;
      max-width: 520px;
      max-height: 92vh;
      background-color: rgba(0,0,0,0.88);
      color: #fff;
      padding: 27px;
      border-radius: 26px;
      z-index: 3000;
      box-shadow: 0 0 18px rgba(0,0,0,0.6);
      text-align: left;
      overflow: hidden;
      box-sizing: border-box;
      /* N√ÉO colocar display:flex aqui; usar .popup.open para exibir */
      flex-direction: column;
    }
    .popup.open { display: flex; } /* s√≥ quando tiver a classe 'open' */

    #pesquisaPopup {
      width:100%; padding:12px; border-radius:8px; border:none; margin-bottom:10px; font-size:16px;
      box-sizing: border-box;
      text-transform: uppercase;
    }

    .popup-lista {
      flex:1; overflow-y:auto; background: rgba(255,255,255,0.06);
      border-radius:8px; padding:4px; margin-bottom:10px;
    }
    .popup-lista .item {
      padding:12px; border-bottom:1px solid rgba(255,255,255,0.08); cursor:pointer; font-size:15px;
    }
    .popup-lista .item:hover { background:#0077cc; color:#fff; }

    .popup-buttons { display:flex; justify-content:center; gap:8px; }
    /* bot√£o vermelho j√° existente no seu CSS (button-clear) */
    .button-clear {
      background-color: #f44336;
      color: #fff;
      padding: 8px 16px;
      margin: 5px;
      cursor: pointer;
      font-size: 14px;
      border-radius: 4px;
      border: none;
    }

    @media (max-width:600px) {
      body { font-size: 17px; }
      #pesquisaPopup { font-size:18px; padding:14px; }
      .popup-lista .item { font-size:18px; padding:14px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>SISTEMA DE CONSULTA BAREMOS</h2>
    <p class="assinatura">¬© 2025 Emanuel Aguiar</p>

    <!-- Pesquisas A / C / G -->
    <div class="linha">
      <label>C√≥digo Baremo:</label>
      <input type="text" id="pesqA" maxlength="10" oninput="this.value=this.value.replace(/[^0-9]/g,'')">
      <button onclick="pesquisar('A')">üîç</button>
    </div>

    <div class="linha">
      <label>CODIGO DE VOZ:</label>
      <input type="text" id="pesqC" maxlength="6" oninput="this.value=this.value.replace(/[^a-zA-Z0-9]/g,'').toUpperCase()">
      <button onclick="pesquisar('C')">üîç</button>
    </div>

    <div class="linha">
      <label>CODIGO PRESTA√á√ÉO:</label>
      <input type="text" id="pesqG" maxlength="6" oninput="this.value=this.value.replace(/[^a-zA-Z0-9]/g,'').toUpperCase()">
      <button onclick="pesquisar('G')">üîç</button>
    </div>

    <div class="btn-grupo">
      <button id="btnBT" onclick="filtrarTipo('BT', this)">BT</button>
      <button id="btnMT" onclick="filtrarTipo('MT', this)">MT</button>
      <button class="btn-limpar" onclick="limparFiltros()">LIMPAR</button>
    </div>

    <div class="resultado" id="resultado">descri√ß√£o da atividade selecionada...</div>

    <!-- Bot√£o que abre a lista -->
    <div class="linha" style="margin-top:12px;">
      <label>LISTA DE BAREMOS:</label>
      <button id="abrirLista" class="button-default">Abrir Lista</button>
    </div>
  </div>

  <!-- POPUP estilo refer√™ncia (inicia escondido) -->
  <div id="popupBaremos" class="popup" role="dialog" aria-hidden="true">
    <h3 style="margin:0 0 10px 0;">Lista de Baremos</h3>
    <input type="text" id="pesquisaPopup" placeholder="Digite para filtrar...">
    <div id="listaPopup" class="popup-lista" aria-label="lista de baremos"></div>
    <div class="popup-buttons">
      <button id="fecharPopup" class="button-clear">Fechar</button>
    </div>
  </div>

<script>
/* ---------------- Dados / fun√ß√µes principais ---------------- */
let cabecalho = [];
let dados = [];
let filtroAtivo = null;

// Carregar CSV (mantive sua l√≥gica, mas sem for√ßar atualizar lista que n√£o existe)
async function carregarCSV() {
  try {
    const resposta = await fetch("dados.csv");
    const texto = await resposta.text();
    const linhas = texto.trim().split("\n").map(l => l.split(";"));
    cabecalho = linhas[0] || [];
    dados = linhas.slice(1) || [];

    // Se existir um <select id="listaB"> (compatib. antiga), atualiza ‚Äî sen√£o ignora.
    if (document.getElementById("listaB")) {
      atualizarLista(true);
    }
  } catch (erro) {
    console.error("Erro ao carregar CSV:", erro);
    const el = document.getElementById("resultado");
    if (el) el.innerText = "ERRO AO CARREGAR DADOS!";
  }
}

/* fun√ß√£o segura para compatibilidade com c√≥digo antigo */
function atualizarLista(incluirDuplicados = false) {
  const lista = document.getElementById("listaB");
  if (!lista) return; // nada a fazer se n√£o existir
  let filtrados = filtroAtivo ? dados.filter(l => l[3] === filtroAtivo) : dados;
  let valoresB = incluirDuplicados ? filtrados.map(l => l[1]) : [...new Set(filtrados.map(l => l[1]))];
  lista.innerHTML = `<option value="">--SELECIONE--</option>` + valoresB.map(v => `<option>${v}</option>`).join("");
}

function pesquisar(coluna) {
  let idxMap = { "A": 0, "C": 2, "G": 6 };
  let idx = idxMap[coluna];
  let inputId = { "A": "pesqA", "C": "pesqC", "G": "pesqG" }[coluna];
  let valor = document.getElementById(inputId).value.trim().toUpperCase();
  if (!valor) return alert("DIGITE UM VALOR!");
  let registro = dados.find(l => (l[idx] || "").toUpperCase() === valor);
  if (registro) mostrarResultado(registro);
  else document.getElementById("resultado").innerText = "NENHUM REGISTRO ENCONTRADO!";
}

function filtrarTipo(tipo, botao) {
  document.querySelectorAll(".btn-grupo button").forEach(b => b.classList.remove("ativo"));
  filtroAtivo = tipo;
  botao.classList.add("ativo");
  // atualizarLista s√≥ quando o select existir (compatibilidade)
  if (document.getElementById("listaB")) atualizarLista();
  document.getElementById("resultado").innerText = `LISTA FILTRADA PELO TIPO ${tipo}`;
}

function limparFiltros() {
  filtroAtivo = null;
  document.querySelectorAll(".btn-grupo button").forEach(b => b.classList.remove("ativo"));
  document.getElementById("pesqA").value = "";
  document.getElementById("pesqC").value = "";
  document.getElementById("pesqG").value = "";
  if (document.getElementById("listaB")) document.getElementById("listaB").value = "";
  document.getElementById("resultado").innerText = "RESULTADO SER√Å EXIBIDO AQUI...";
  if (document.getElementById("listaB")) atualizarLista(true);
}

function mostrarResultado(registro) {
  let descricao = registro[9] || "";
  let camposHTML = `
    <div><strong>${cabecalho[0] || 'A'}:</strong> ${registro[0] || ''}</div>
    <div><strong>${cabecalho[1] || 'B'}:</strong> ${registro[1] || ''}</div>
    <div><strong>${cabecalho[2] || 'C'}:</strong> ${registro[2] || ''}</div>
    <div><strong>${cabecalho[3] || 'D'}:</strong> ${registro[3] || ''}</div>
    <div><strong>${cabecalho[6] || 'G'}:</strong> ${registro[6] || ''}</div>
  `;
  document.getElementById("resultado").innerHTML = `
    <div style="padding:10px;">
      ${camposHTML}
      <div style="margin-top:12px;">
        <strong>${cabecalho[9] || 'DESCRI√á√ÉO'}:</strong>
        <div style="
          background:#ffffff;
          border:1px solid #ddd;
          border-radius:12px;
          padding:12px;
          margin-top:8px;
          box-shadow:0 2px 6px rgba(0,0,0,0.06);
          font-size:14px;
          line-height:1.4;
          color:#111;
        ">
          ${descricao}
        </div>
      </div>
    </div>
  `;
}

/* ---------------- Popup: abrir / fechar / renderizar lista ---------------- */
document.addEventListener("DOMContentLoaded", () => {
  const abrirBtn = document.getElementById("abrirLista");
  const popup = document.getElementById("popupBaremos");
  const fecharBtn = document.getElementById("fecharPopup");
  const pesquisa = document.getElementById("pesquisaPopup");
  const listaContainer = document.getElementById("listaPopup");

  function abrirPopup() {
    popup.classList.add("open");
    popup.setAttribute("aria-hidden","false");
    pesquisa.value = "";           // limpa pesquisa ao abrir
    renderizarPopupLista("");      // carrega todos
    // opcional: n√£o focar o input para evitar abrir teclado automaticamente
    // pesquisa.focus(); // s√≥ descomente se quiser abrir teclado automaticamente
  }

  function fecharPopup() {
    popup.classList.remove("open");
    popup.setAttribute("aria-hidden","true");
  }

  abrirBtn.addEventListener("click", abrirPopup);
  fecharBtn.addEventListener("click", fecharPopup);

  // fecha ao clicar fora do conte√∫do (clicar no overlay)
  popup.addEventListener("click", (e) => {
    if (e.target === popup) fecharPopup();
  });

  // filtrar enquanto digita
  pesquisa.addEventListener("input", function () {
    renderizarPopupLista(this.value);
  });

  // renderiza lista dentro do popup
  function renderizarPopupLista(filtro = "") {
    filtro = (filtro || "").toUpperCase();
    const filtrados = dados.filter(l => {
      const nome = (l[1] || "").toUpperCase();
      const tipoOK = !filtroAtivo || (l[3] === filtroAtivo);
      return tipoOK && nameMatches(nome, filtro);
    });

    listaContainer.innerHTML = "";
    if (filtrados.length > 0) {
      filtrados.forEach(r => {
        const div = document.createElement("div");
        div.className = "item";
        div.textContent = r[1] || "";
        div.addEventListener("click", () => {
          fecharPopup();
          mostrarResultado(r);
        });
        listaContainer.appendChild(div);
      });
    } else {
      listaContainer.innerHTML = "<div style='padding:12px;color:#bbb;'>Nenhum resultado</div>";
    }
  }

  function nameMatches(nome, filtro) {
    if (!filtro) return true; // sem filtro: corresponde tudo
    return nome.includes(filtro);
  }

  // Expor para console (se precisar)
  window.renderizarPopupLista = renderizarPopupLista;
});

// Chama o carregamento do CSV
carregarCSV();
</script>
</body>
</html>
